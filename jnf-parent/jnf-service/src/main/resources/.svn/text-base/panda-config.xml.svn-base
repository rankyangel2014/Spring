<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:jee="http://www.springframework.org/schema/jee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context" xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:aop="http://www.springframework.org/schema/aop" xmlns:panda="http://panda.jsjn.com/schema/panda"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd 
	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
	http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-3.0.xsd 
	http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
	http://www.springframework.org/schema/aop  
	http://www.springframework.org/schema/aop/spring-aop-3.0.xsd 
	http://panda.jsjn.com/schema/panda 
	classpath:/panda.xsd"
	default-lazy-init="true">

	<panda:pandaServerConfig>
		<panda:applicationNode>
			<panda:property name="id" value="0020" />
			<panda:property name="name" value="0020" />
			<panda:property name="version" value="0.0.1" />
			<panda:property name="ip" value="127.0.0.1" />
			<panda:property name="port" value="8082" />
			<!-- Used in "dev" mode. Ignored in "run" mode. -->
			<panda:property name="jettyPort" value="8085" />
			<panda:property name="createdate" value="2013-12-01 12:01:01" />
			<panda:property name="verification" value="true" />
			<!-- 0-regist all services (panda service, spring service, etc.); 1-only 
				regist panda service with provided(not generated by system) "regId"; 2-only 
				regist service defined in ServiceInterface.soa.xml. -->
			<panda:property name="regLevel" value="1" />
			<panda:property name="useToken" value="false" />
		</panda:applicationNode>
		<!-- tds 注册地址 -->
		<panda:registery>
			<panda:property name="userName" value="userName" />
			<panda:property name="password" value="password" />
			<panda:property name="serverIP" value="127.0.0.1" />
			<panda:property name="serverPort" value="4601" />
			<panda:property name="heartbeat" value="1000000" /><!--单位毫秒 -->
		</panda:registery>
		<panda:defualtPerformance>
			<panda:property name="maxuser" value="30" />
			<panda:property name="timeout" value="120000" /><!--单位毫秒 -->
			<panda:property name="cluster" value="lru" />
			<panda:property name="router" value="Failover" />
			<panda:property name="retrymode" value="RR" />
			<panda:property name="allowIP" value="127.0.0.1" />
			<panda:property name="allowTime" value="40" />
			<panda:property name="version" value="0.1.0" />
		</panda:defualtPerformance>
		<panda:nettyConfig>
			<panda:property name="boss_group" value="1" />
			<panda:property name="worker_group" value="8" />
			<panda:property name="so_backlog" value="1000" />
			<panda:property name="buf_size" value="409600" /><!--单位bit -->
		</panda:nettyConfig>
		<panda:taskThreadPoolConfig>
			<panda:property name="core_pool_size" value="500" />
			<panda:property name="max_size" value="2000" />
			<panda:property name="keep_alive_time" value="30" />
			<panda:property name="queue_size" value="1000" />
		</panda:taskThreadPoolConfig>
	</panda:pandaServerConfig>

	<!-- TODO 数据库密码加密存储 majian -->
	<bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"
		destroy-method="close">
		<property name="driverClass">
			<value>${driverClass}</value>
		</property>
		<property name="jdbcUrl">
			<value>${jdbcUrl}</value>
		</property>
		<property name="properties">
			<props>
				<prop key="user">${user}</prop>
				<prop key="password">${password}</prop>
			</props>
		</property>
	</bean>
	

	<!--声明事务,自动管理配置数据源 -->
	<bean id="transactionManager"
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource">
			<ref local="dataSource" />
		</property>
	</bean>
	<!--用注解来实现事务管理 -->
	<tx:annotation-driven transaction-manager="transactionManager"
		proxy-target-class="true" />

	<bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
		<property name="dataSource" ref="dataSource" />
		<property name="typeAliasesPackage" value="com.jsjn.jnf" />
		<property name="mapperLocations" value="classpath:/mappings/**/*.xml" />
		<property name="configLocation" value="classpath:/mybatis-config.xml" />
	</bean>
</beans>
